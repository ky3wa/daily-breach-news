# -*- coding: utf-8 -*-
"""security breach link

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1VAcog_CutaaDNE1mC6IElqPwHq0tX1ut
"""

import requests
import feedparser
import re
from datetime import datetime, timezone
from transformers import pipeline

# 1. ì›ë³¸ RSS URLê³¼ AllOrigins í”„ë¡ì‹œ URL
rss_url   = 'https://databreaches.net/feed/'
proxy_url = 'https://api.allorigins.win/raw?url=' + rss_url

# 2. ì˜¤ëŠ˜ ë‚ ì§œ (UTC ê¸°ì¤€)
today = datetime.now(timezone.utc).date()

# 3. Hugging Face ìš”ì•½ íŒŒì´í”„ë¼ì¸ ë¡œë”©
summarizer = pipeline(
    "summarization",
    model="facebook/bart-large-cnn",
    device=0  # GPUê°€ ì—†ìœ¼ë©´ ì œê±°í•˜ì„¸ìš”
)

# 4. AllOrigins í†µí•´ RSS ê°€ì ¸ì˜¤ê¸°
try:
    resp = requests.get(proxy_url, headers={'User-Agent': 'Mozilla/5.0'}, timeout=10)
    resp.raise_for_status()
    feed = feedparser.parse(resp.text)
except Exception as e:
    print("âŒ RSS fetch error:", e)
    feed = None

# 5. ì˜¤ëŠ˜ì ê¸°ì‚¬ ìˆ˜ì§‘ ë° ì œëª©Â·ë§í¬Â·ìš”ì•½ ì €ì¥
articles = []
if feed:
    for entry in feed.entries:
        if 'published_parsed' in entry:
            pub_date = datetime(*entry.published_parsed[:6], tzinfo=timezone.utc).date()
            if pub_date == today:
                # HTML íƒœê·¸ ì œê±°í•œ ì›ë¬¸ ìš”ì•½ í…ìŠ¤íŠ¸
                raw_summary = entry.get('summary', '')
                clean_summary = re.sub(r'<[^>]+>', '', raw_summary)
                # AI ìš”ì•½ ìƒì„±
                try:
                    ai_sum = summarizer(
                        clean_summary,
                        max_length=60,
                        min_length=15,
                        do_sample=False
                    )[0]['summary_text'].strip()
                except Exception:
                    ai_sum = "(AI summary unavailable)"
                articles.append({
                    'title': entry.title,
                    'link': entry.link,
                    'ai_summary': ai_sum
                })

# 6. ê²°ê³¼ ì¶œë ¥
count = len(articles)
print(f"ğŸ“… Data from DataBreaches.net - What Happened today ({today}) in Cyber?: Today, we have {count} data breaches\n")

if articles:
    for i, art in enumerate(articles, 1):
        print(f"{i}. {art['title']}")
        print(f"   ğŸ”— {art['link']}")
        print(f"   ğŸ§ AI Summary: {art['ai_summary']}\n")
else:
    print("âŒ ì˜¤ëŠ˜ ë‚ ì§œì˜ ë‰´ìŠ¤ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.")